<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Paragraph Processor</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 2em;
      background: #f9f9f9;
    }
    h1 { text-align: center; }

    .controls { margin-bottom: 1.5em; }

    textarea, input[type="file"] {
      width: 100%;
      box-sizing: border-box;
      padding: 0.6em;
      margin-top: 0.3em;
      font-family: inherit;
      font-size: 1em;
      border-radius: 6px;
      border: 1px solid #ccc;
    }

    #outputBox {
      background: white;
      border-radius: 8px;
      padding: 1em;
      min-height: 150px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      margin-top: 1em;
      line-height: 1.6;
    }

    .pagination {
      display: flex;
      justify-content: space-between;
      margin-top: 1em;
    }

    button {
      padding: 0.5em 1em;
      border: none;
      border-radius: 4px;
      background-color: #007BFF;
      color: white;
      cursor: pointer;
      transition: background 0.2s;
    }
    button:hover { background-color: #0056b3; }
    button:disabled { background-color: #ccc; cursor: not-allowed; }

    label { font-weight: bold; margin-top: 1em; display: block; }
  </style>
</head>
<body>

  <h1>Paragraph Processor</h1>
  <a href="index.html">‚Üê Back to Home</a>
  <div class="controls">
    <label>Top Text (can include multiple lines):</label>
    <textarea id="topText" rows="4">
What: Fix <priority number> alert #<index of the paragraph in the text provided> <Paragraph name>
When: Date 
How: Follow the steps given in the TSG to resolve the alert.

Updates:
    </textarea>

    <label>Bottom Text (can include multiple lines):</label>
    <textarea id="bottomText" rows="4"> 
  
Open Question: NA
Blocked Items: NA
Action Items: NA
    </textarea>

    <label>Paste your text here or upload a .txt file:</label>
    <textarea id="inputText" rows="8" placeholder="Paste text here..."></textarea>
    <input type="file" id="fileInput" accept=".txt" />
    <button id="processBtn">Process</button>
  </div>

  <div id="outputSection" style="display:none;">
    <div id="outputBox"></div>

    <div class="pagination">
      <button id="prevBtn">‚Üê Previous</button>
      <button id="copyBtn">üìã Copy Paragraph</button>
      <button id="nextBtn">Next ‚Üí</button>
    </div>

    <p style="text-align:center;">
      <span id="pageInfo"></span>
    </p>
  </div>

  <script>
    const processBtn = document.getElementById('processBtn');
    const inputText = document.getElementById('inputText');
    const fileInput = document.getElementById('fileInput');
    const outputBox = document.getElementById('outputBox');
    const outputSection = document.getElementById('outputSection');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const copyBtn = document.getElementById('copyBtn');
    const pageInfo = document.getElementById('pageInfo');
    const topTextInput = document.getElementById('topText');
    const bottomTextInput = document.getElementById('bottomText');

    let paragraphs = [];
    let currentPage = 0;

    // Read file and show contents in textarea
    fileInput.addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = (event) => {
        inputText.value = event.target.result;
      };
      reader.readAsText(file);
    });

    // Process input text into paragraphs
    processBtn.addEventListener('click', () => {
      const text = inputText.value.trim();
      if (!text) {
        alert("Please paste or upload some text first.");
        return;
      }

      const topTemplate = topTextInput.value;
      const bottomTemplate = bottomTextInput.value;

      // Split text into paragraphs using blank lines
      const rawParagraphs = text.split(/\n\s*\n+/);
      
      paragraphs = rawParagraphs.map((p, index) => {
        const trimmedP = p.trim();
        const lines = trimmedP.split('\n');
        
        // Extract title (first line)
        const titleLine = lines[0] || '';
        
        // Parse priority (P3, P4, etc.) and paragraph name
        const priorityMatch = titleLine.match(/\b(P\d+)\b/i);
        const priority = priorityMatch ? priorityMatch[1].toUpperCase() : 'P3';
        
        // Remove priority from title to get paragraph name
        const paragraphName = titleLine.replace(/\b(P\d+)\b/i, '').trim();
        
        // Create top text with parsed values
        const customTop = topTemplate
          .replace(/<priority number>/g, priority)
          .replace(/<index of the paragraph in the text provided>/g, index + 1)
          .replace(/<Paragraph name>/g, paragraphName);
        
        // Format remaining lines as bullet points
        const contentLines = lines.slice(1).filter(line => line.trim());
        const bulletPoints = contentLines.map(line => `‚Ä¢ ${line.trim()}`).join('\n');
        
        return {
          title: titleLine,
          content: bulletPoints,
          top: customTop,
          bottom: bottomTemplate
        };
      });

      if (paragraphs.length === 0) {
        alert("No paragraphs detected.");
        return;
      }

      currentPage = 0;
      outputSection.style.display = "block";
      showPage();
    });

    function showPage() {
      const para = paragraphs[currentPage];
      
      // Build formatted output with HTML
      let html = '';
      
      // Add top text
      html += para.top.replace(/\n/g, '<br>');
      html += '<br><br>';
      
      // Add title (bold)
      html += `<strong>${para.title}</strong>`;
      html += '<br><br>';
      
      // Add content (bullet points)
      if (para.content) {
        html += para.content.replace(/\n/g, '<br>');
        html += '<br>';
      }
      
      // Add bottom text with one line space before
      html += '<br>';
      html += para.bottom.replace(/\n/g, '<br>');
      
      outputBox.innerHTML = html;
      pageInfo.textContent = `Paragraph ${currentPage + 1} of ${paragraphs.length}`;
      prevBtn.disabled = currentPage === 0;
      nextBtn.disabled = currentPage === paragraphs.length - 1;
    }

    prevBtn.addEventListener('click', () => {
      if (currentPage > 0) {
        currentPage--;
        showPage();
      }
    });

    nextBtn.addEventListener('click', () => {
      if (currentPage < paragraphs.length - 1) {
        currentPage++;
        showPage();
      }
    });

    copyBtn.addEventListener('click', () => {
      const para = paragraphs[currentPage];
      const plainText = `${para.top}\n\n${para.title}\n\n${para.content}\n\n${para.bottom}`;
      
      navigator.clipboard.writeText(plainText)
        .then(() => alert("Paragraph copied to clipboard!"))
        .catch(() => alert("Failed to copy."));
    });
  </script>
</body>
</html>